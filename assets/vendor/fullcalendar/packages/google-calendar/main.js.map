{"version":3,"file":"main.js","sources":["../../../tmp/tsc-output/packages/google-calendar/src/main.js"],"sourcesContent":["import * as tslib_1 from \"tslib\";\nimport { createPlugin, refineProps, addDays, requestJson } from '@fullcalendar/core';\n// TODO: expose somehow\nvar API_BASE = 'https://www.googleapis.com/calendar/v3/calendars';\nvar STANDARD_PROPS = {\n    url: String,\n    googleCalendarApiKey: String,\n    googleCalendarId: String,\n    googleCalendarApiBase: String,\n    data: null\n};\nvar eventSourceDef = {\n    parseMeta: function (raw) {\n        if (typeof raw === 'string') {\n            raw = { url: raw };\n        }\n        if (typeof raw === 'object') {\n            var standardProps = refineProps(raw, STANDARD_PROPS);\n            if (!standardProps.googleCalendarId && standardProps.url) {\n                standardProps.googleCalendarId = parseGoogleCalendarId(standardProps.url);\n            }\n            delete standardProps.url;\n            if (standardProps.googleCalendarId) {\n                return standardProps;\n            }\n        }\n        return null;\n    },\n    fetch: function (arg, onSuccess, onFailure) {\n        var calendar = arg.calendar;\n        var meta = arg.eventSource.meta;\n        var apiKey = meta.googleCalendarApiKey || calendar.opt('googleCalendarApiKey');\n        if (!apiKey) {\n            onFailure({\n                message: 'Specify a googleCalendarApiKey. See http://fullcalendar.io/docs/google_calendar/'\n            });\n        }\n        else {\n            var url = buildUrl(meta);\n            var requestParams_1 = buildRequestParams(arg.range, apiKey, meta.data, calendar.dateEnv);\n            requestJson('GET', url, requestParams_1, function (body, xhr) {\n                if (body.error) {\n                    onFailure({\n                        message: 'Google Calendar API: ' + body.error.message,\n                        errors: body.error.errors,\n                        xhr: xhr\n                    });\n                }\n                else {\n                    onSuccess({\n                        rawEvents: gcalItemsToRawEventDefs(body.items, requestParams_1.timeZone),\n                        xhr: xhr\n                    });\n                }\n            }, function (message, xhr) {\n                onFailure({ message: message, xhr: xhr });\n            });\n        }\n    }\n};\nfunction parseGoogleCalendarId(url) {\n    var match;\n    // detect if the ID was specified as a single string.\n    // will match calendars like \"asdf1234@calendar.google.com\" in addition to person email calendars.\n    if (/^[^\\/]+@([^\\/\\.]+\\.)*(google|googlemail|gmail)\\.com$/.test(url)) {\n        return url;\n    }\n    else if ((match = /^https:\\/\\/www.googleapis.com\\/calendar\\/v3\\/calendars\\/([^\\/]*)/.exec(url)) ||\n        (match = /^https?:\\/\\/www.google.com\\/calendar\\/feeds\\/([^\\/]*)/.exec(url))) {\n        return decodeURIComponent(match[1]);\n    }\n}\nfunction buildUrl(meta) {\n    var apiBase = meta.googleCalendarApiBase;\n    if (!apiBase) {\n        apiBase = API_BASE;\n    }\n    return apiBase + '/' + encodeURIComponent(meta.googleCalendarId) + '/events';\n}\nfunction buildRequestParams(range, apiKey, extraParams, dateEnv) {\n    var params;\n    var startStr;\n    var endStr;\n    if (dateEnv.canComputeOffset) {\n        // strings will naturally have offsets, which GCal needs\n        startStr = dateEnv.formatIso(range.start);\n        endStr = dateEnv.formatIso(range.end);\n    }\n    else {\n        // when timezone isn't known, we don't know what the UTC offset should be, so ask for +/- 1 day\n        // from the UTC day-start to guarantee we're getting all the events\n        // (start/end will be UTC-coerced dates, so toISOString is okay)\n        startStr = addDays(range.start, -1).toISOString();\n        endStr = addDays(range.end, 1).toISOString();\n    }\n    params = tslib_1.__assign({}, (extraParams || {}), { key: apiKey, timeMin: startStr, timeMax: endStr, singleEvents: true, maxResults: 9999 });\n    if (dateEnv.timeZone !== 'local') {\n        params.timeZone = dateEnv.timeZone;\n    }\n    return params;\n}\nfunction gcalItemsToRawEventDefs(items, gcalTimezone) {\n    return items.map(function (item) {\n        return gcalItemToRawEventDef(item, gcalTimezone);\n    });\n}\nfunction gcalItemToRawEventDef(item, gcalTimezone) {\n    var url = item.htmlLink || null;\n    // make the URLs for each event show times in the correct timezone\n    if (url && gcalTimezone) {\n        url = injectQsComponent(url, 'ctz=' + gcalTimezone);\n    }\n    return {\n        id: item.id,\n        title: item.summary,\n        start: item.start.dateTime || item.start.date,\n        end: item.end.dateTime || item.end.date,\n        url: url,\n        location: item.location,\n        description: item.description\n    };\n}\n// Injects a string like \"arg=value\" into the querystring of a URL\n// TODO: move to a general util file?\nfunction injectQsComponent(url, component) {\n    // inject it after the querystring but before the fragment\n    return url.replace(/(\\?.*?)?(#|$)/, function (whole, qs, hash) {\n        return (qs ? qs + '&' : '?') + component + hash;\n    });\n}\nexport default createPlugin({\n    eventSourceDefs: [eventSourceDef]\n});\n"],"names":["tslib_1.__assign"],"mappings":"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"}